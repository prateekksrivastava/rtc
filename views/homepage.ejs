<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
    <title>Chat Room</title>
    <style>
        body {
          margin: 0 auto;
          max-width: 800px;
          padding: 0 20px;
          background-color: black;
          color: white;
        }
        
        .wrapper {
            border: 1px solid rgb(114, 52, 52);
        }

        .message {
          background-color: #f1f1f1;
          border-radius: 5px;
          padding: 10px;
          width: 450px;
          margin: 10px 0;
          background-image: linear-gradient(to bottom right, #cb4154, #00AEAE);
        }
        
        .message::after {
          content: "";
          clear: both;
          display: table;
        }
        
        .message img {
          float: left;
          max-width: 60px;
          width: 100%;
          cursor: grab;
          margin-right: 20px;
          border-radius: 50%;
        }
        
        .message img.right {
          float: right;
          margin-left: 20px;
          margin-right:0;
        }

        .right {
            float: right;
            clear: both;
        }

        .left {
            float: left;
            clear: both;
        }

        .time-right {
            float: right;
        }

        .btn-block {
            border: 1px solid white;
            color: white;
        }
    </style>
</head>

<script src="/socket.io/socket.io.js"></script>

<body>
    <div class="wrapper">
        <a href="/logout" style="float: right;" type="button" class="btn btn-block">Logout</a>

        <h2>Real time chat application </h2>
        <div id="message-container">
            <!-- <div class="message right"><img src="#" title="<%= user.displayName%>" alt="Avatar" style="width:100%;"><p>Hey</p><span class="time-right">ewd</span></div>

            <div class="message left"><img src="#" title="<%= user.displayName%>" alt="Avatar" style="width:100%;"><p>How are you?</p><span class="time-right">sdf</span></div> -->
        </div>
        
        <input type="text" id="message" class="form-control" placeholder="Write a message.." style="width: 665px; display: inline-block;">
        <button type="button" class="btn btn-block" name="button" onclick="sendMessage()">Send</button>
    </div>
    <script>
        const socket = io();
        var user = 'Prateek';

        function sendMessage() {
            var msg = document.getElementById('message').value;
            
            if (msg){
                socket.emit('chat', {message: msg, user: user});
            }
        }
        var current = new Date();

        socket.on('chat-message', function(data){
            if (user){
                document.getElementById('message-container').innerHTML +='<div class="message"><img src="<%= user.picture %>" title="<%= user.displayName%>" alt="Avatar" style="width:100%;"><p>'+ data.message +'</p><span class="time-right">'+current.toLocaleTimeString()+'s</span></div>';

                document.getElementById('message').value = '';
            }
        })
    </script>
</body>
</html>